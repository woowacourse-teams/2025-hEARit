<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>히어릿 업로드</title>
</head>
<body>
<h1>히어릿 업로드</h1>

<form id="upload-form">
    <div>
        <label for="title">제목</label>
        <input type="text" id="title" name="title">
    </div>
    <div>
        <label for="summary">요약</label>
        <input type="text" id="summary" name="summary">
    </div>
    <div>
        <label for="playTime">재생 시간(초)</label>
        <input type="number" id="playTime" name="playTime">
    </div>
    <div>
        <label for="originalAudioUrl">원본 오디오 URL</label>
        <input type="text" id="originalAudioUrl" name="originalAudioUrl">
    </div>
    <div>
        <label for="shortAudioUrl">요약 오디오 URL</label>
        <input type="text" id="shortAudioUrl" name="shortAudioUrl">
    </div>
    <div>
        <label for="scriptUrl">대본 URL</label>
        <input type="text" id="scriptUrl" name="scriptUrl">
    </div>
    <div>
        <label for="source">출처</label>
        <input type="text" id="source" name="source">
    </div>
    <div>
        <label for="categoryId">카테고리</label>
        <select id="categoryId" name="categoryId" required>
            <option value="" disabled selected>카테고리를 선택하세요</option>
        </select>
    </div>
    <div>
        <label>키워드</label>
        <div id="keyword-checkboxes">
            <!-- 키워드 체크박스가 여기에 동적으로 추가됩니다. -->
        </div>
    </div>
    <button type="button" onclick="uploadHearit()">업로드</button>
</form>

<script>
    document.addEventListener('DOMContentLoaded', async function() {
        // 카테고리 로드
        try {
            const response = await fetch('/api/v1/admin/categories');
            if (response.ok) {
                const categories = await response.json();
                const categorySelect = document.getElementById('categoryId');
                categories.forEach(category => {
                    const option = document.createElement('option');
                    option.value = category.id;
                    option.textContent = category.name;
                    categorySelect.appendChild(option);
                });
            } else {
                console.error('카테고리를 불러오는 데 실패했습니다.');
            }
        } catch (error) {
            console.error('Error:', error);
        }

        // 키워드 로드
        try {
            const response = await fetch('/api/v1/admin/keywords');
            if (response.ok) {
                const keywords = await response.json();
                const keywordCheckboxes = document.getElementById('keyword-checkboxes');
                keywords.forEach(keyword => {
                    const label = document.createElement('label');
                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.name = 'keywordIds';
                    checkbox.value = keyword.id;
                    label.appendChild(checkbox);
                    label.appendChild(document.createTextNode(keyword.name));
                    keywordCheckboxes.appendChild(label);
                });
            } else {
                console.error('키워드를 불러오는 데 실패했습니다.');
            }
        } catch (error) {
            console.error('Error:', error);
        }
    });

    async function uploadHearit() {
        const form = document.getElementById('upload-form');
        const formData = new FormData(form);
        const data = Object.fromEntries(formData.entries());
        data.keywordIds = formData.getAll('keywordIds').map(id => parseInt(id, 10));


        if (!data.categoryId) {
            alert('카테고리를 선택해주세요.');
            return;
        }

        data.playTime = parseInt(data.playTime, 10);
        data.categoryId = parseInt(data.categoryId, 10);

        try {
            const response = await fetch('/api/v1/admin/hearits', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            });

            if (response.ok) {
                alert('히어릿이 성공적으로 업로드되었습니다.');
                window.location.href = '/admin';
            } else {
                const errorData = await response.json();
                alert('업로드 실패: ' + (errorData.message || '서버 오류'));
            }
        } catch (error) {
            console.error('Error:', error);
            alert('업로드 중 오류가 발생했습니다.');
        }
    }
</script>

</body>
</html> 